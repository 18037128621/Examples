function phoneReg(){$("#username").blur(function(){$("#msg").html("")}),$("#username").keyup(function(){var a=$(this).val();/^1(3|4|5|7|8)\d{9}$/.test(a)?$.ajax({type:"post",url:"/admin/user/register",data:"username="+$("#username").val()}).done(function(a){0==a.success?$("#msg").html(a.msg):1==a.success&&$("#msg").html(a.msg)}):$("#msg").html("手机号码有误，请重填")})}function pwdReg(){$("#password").blur(function(){$("#msg").html("")}),$("#password").focus(function(){$("#msg").html("<font color='gray'>强烈建议密码长度为8-20字符</font>")}),$("#password").keyup(function(){$(this).val().length<6?$("#msg").html("密码不能小于6!"):$("#msg").html("")})}function phoneRegReturn(){var a=$("#username").val();return/^1(3|4|5|7|8)\d{9}$/.test(a)?1:0}$(function(){$(".del").click(function(a){var b=$(this).attr("id"),c=$(".item-id-"+b);$.ajax({type:"delete",url:"/admin/movie/index?id="+b}).done(function(a){1===a.success&&c.length>0&&c.remove()})}),$(".userDel").click(function(a){var b=$(this).attr("id"),c=$(".item-id-"+b);$.ajax({type:"delete",url:"/admin/user/index?id="+b}).done(function(a){1===a.success&&c.length>0&&c.remove()})}),$(".cateDel").click(function(a){var b=$(this).attr("id"),c=$(".item-id-"+b);$.ajax({type:"delete",url:"/admin/cate/index?id="+b}).done(function(a){1===a.success?c.length>0&&c.remove():0===a.success&&layer.alert("请先删除该分类下的所有文章!",{icon:5,skin:"layer-ext-moon"})})}),$("#sendCode").click(function(){function a(){0==b?(c.html("获取验证码"),b=10,c.removeClass("codeClick"),$("#sendCode").removeAttr("disabled")):($("#sendCode").attr("disabled","true"),c.addClass("codeClick"),c.html("重新发送"+b+"s"),b--,setTimeout(function(){a()},1e3))}var b=10,c=$(this),d=phoneRegReturn();return 0==d?($("#msg").html("请输入正确手机号后发送!"),!1):(d=$("#username").val(),void $.ajax({type:"post",url:"/admin/code",data:"phone="+d}).done(function(b){1===b.success&&($("#msg").html("<font color='green'>发送成功,请查收</font>"),a())}))}),$("#douban").blur(function(){var a=$("#douban").val();a&&$.ajax({type:"get",url:"https://api.douban.com/v2/movie/subject/"+a,cache:!0,dataType:"jsonp",crossDomain:!0,jsonp:"callback",success:function(a){$("#inputTitle").val(a.title),$("#inputDoctor").val(a.directors[0].name),$("#inputCountry").val(a.countries[0]),$("#inputPoster").val(a.images.large),$("#inputYear").val(a.year),$("#inputSummary").val(a.summary)}})}),$("#inputUpload").change(function(){var a=new FormData;a.append("file",$("#inputUpload")[0].files[0]),$.ajax({type:"post",url:"/admin/uploadImg",data:a,dataType:"json",processData:!1,contentType:!1}).done(function(a){1==a.success&&($("#inputPoster").val("/upload/"+a.url),$("#poster").attr("style",""),$("#posterImg").attr("src","/upload/"+a.url),$("#updatePoster").css("display","none"))})})}),$(function(){$("input[name=doSubmit]").click(function(){var a=$("#username").val(),b=$("#reisterCode").val(),c=$("#password").val();$.ajax({type:"post",url:"/admin/register",data:"username="+a+"&code="+b+"&password="+c}).done(function(a){0==a.success?$("#msg").html(a.msg):1==a.success&&($("#msg").html("<font color='green'>"+a.msg+"</font>"),setTimeout(function(){window.location.href="http://127.0.0.1:3000/admin/login"},3e3))})})}),phoneReg(),pwdReg();