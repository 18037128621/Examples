function showAnswer(a){return void 0==$("#userId").attr("userId")?(layer.alert("您还未登录,请登录后在回复!",{icon:5,skin:"layer-ext-moon"}),!1):($("#show-"+a).css("display","none"),$("#hide-"+a).css("display","inline-block"),displayAnswer(a,"block"),void $("#"+a).click(function(){if(""==$("#reply-"+a).val())return layer.alert("回复内容不能为空!",{icon:5,skin:"layer-ext-moon"}),!1;var b=$("input[name=cid"+a+"]").val(),c=$("input[name=tid"+a+"]").val(),d=$("input[name=from"+a+"]").val(),e=$("input[name='"+a+"']").val();$.ajax({type:"post",url:"/user/comment/",data:"cid="+b+"&tid="+c+"&from="+d+"&content="+e}).done(function(a){var b=FormatDate(a.reply.createAt),c=$("<div class='commentItem clearfix'>"),d=$("<div class='col-1 userPhoto'><img src='/image/photo.jpg' alt=''></div>"),e=$(" <div class='col-11 commentMain'></div>"),f=$(" <p class='title'><span class='userName'>"+a.reply.from.username+"</span><span class='publishTime'>"+b+"</span></p>");if(a.reply.from.username==a.reply.to.username)var g=$("<p class='content'>"+a.reply.content+"</p>");else var g=$("<p class='content'><span class='aite'>回复@"+a.reply.to.username+":</span>"+a.reply.content+"</p>");var h=$(" <p class='comicon'><i class='fa fa-thumbs-o-up'></i><i class='fa fa-thumbs-o-down'></i></p>"),i=$("<span onclick=\"showAnswer('"+a.reply._id+"')\" id='show-"+a.reply._id+"'>回复</span>"),j=$("<span onclick=\"hideAnswer('"+a.reply._id+"')\" id='hide-"+a.reply._id+"' style='display:none'>取消回复</span>"),k=$("<span>分享</span>"),l=$("<div class='div answer data-id-"+a.reply._id+"'>"),m=$("<form></form>"),n=$("<input type='hidden' name='cid"+a.reply._id+"' value='"+a.cid+"'>"),o=$("<input type='hidden' name='tid"+a.reply._id+"' value='"+a.reply.to._id+"'>"),p=$("<input type='hidden' name='from"+a.reply._id+"' value='"+$("#userId").attr("userId")+"'>"),q=$("<input placeholder='0/140字' class='form-control' id='reply-"+a.reply._id+"' name="+a.reply._id+">"),r=$("<button type='button' class='btn btn-success answerBtn ' id="+a.reply._id+">回复评论</button>");h.append(i),h.append(j),h.append(k),m.append(n),m.append(o),m.append(p),m.append(q),m.append(r),l.append(m),e.append(f),e.append(g),e.append(h),e.append(l),c.append(d),c.append(e),$("#answer-id-"+a.cid).after(c)})}))}function hideAnswer(a){$("#show-"+a).css("display","inline-block"),$("#hide-"+a).css("display","none"),displayAnswer(a,"none")}function displayAnswer(a,b){$(".data-id-"+a).css("display",b)}function FormatDate(a){var b=new Date(a);return b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()}$(function(){$("#publishComment").click(function(a){if(""==$("#com-textarea").val())return layer.alert("您还没有输入内容呢!",{icon:5,skin:"layer-ext-moon"}),!1;var b=$("input[name=movie]").val(),c=$("input[name=from]").val(),d=$("textarea[name=content]").val();$.ajax({type:"post",url:"/user/comment/",data:"movie="+b+"&from="+c+"&content="+d}).done(function(a){if(1==a.success){var b=parseInt($(".commentCount").text())+1;$(".commentCount").text(b);var c=FormatDate(a.movie.meta.createAt),d=$(".comTit02"),e=$("<div class='commentItem clearfix'>"),f=$("<div class='col-1 userPhoto'><img src='/image/photo.jpg' alt=''></div>"),g=$(" <div class='col-11 commentMain'></div>"),h=$(" <p class='title'><span class='userName'>"+a.movie.from.username+"</span><span class='publishTime'>"+c+"</span></p>"),i=$("<p class='content'>"+a.movie.content+"</p>"),j=$(" <p class='comicon'><i class='fa fa-thumbs-o-up'></i><i class='fa fa-thumbs-o-down'></i></p>"),k=$("<span onclick=\"showAnswer('"+a.movie._id+"')\" id='show-"+a.movie._id+"'>回复</span>"),l=$("<span onclick=\"hideAnswer('"+a.movie._id+"')\" id='hide-"+a.movie._id+"' style='display:none'>取消回复</span>"),m=$("<span>分享</span>"),n=$("<div class='div answer data-id-"+a.movie._id+"'>"),o=$("<form></form>"),p=$("<input type='hidden' name='cid"+a.movie._id+"' value='"+a.movie._id+"'>"),q=$("<input type='hidden' name='tid"+a.movie._id+"' value='"+a.movie.from._id+"'>"),r=$("<input type='hidden' name='from"+a.movie._id+"' value='"+$("#userId").attr("userId")+"'>"),s=$("<input placeholder='0/140字' class='form-control' id='reply-"+a.movie._id+"' name="+a.movie._id+">"),t=$("<button type='submit' class='btn btn-success answerBtn ' id="+a.movie._id+">回复评论</button>");j.append(k),j.append(l),j.append(m),o.append(p),o.append(q),o.append(r),o.append(s),o.append(t),n.append(o),g.append(h),g.append(i),g.append(j),g.append(n),e.append(f),e.append(g),d.after(e)}})})});